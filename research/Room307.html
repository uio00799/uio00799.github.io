<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROOM 307 — Evidence Board (AR/VR Hacker)</title>
<style>
  :root{
    --bg:#0a0f1e; --grid:#0df; --neon:#00f5ff; --accent:#7cffb2; --danger:#ff3b6b; --ok:#79ff97;
    --card:#0a1328aa; --glass:rgba(15,25,50,.55); --white:#e8f4ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--white); background:radial-gradient(1200px 800px at 50% -20%,#113 0%,#0a0f1e 60%,#030611 100%);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    overflow-x:hidden; perspective:1200px;
  }

  /* AR/VR grid */
  .grid3d{
    position:fixed; inset:0; z-index:-2; transform-style:preserve-3d; overflow:hidden;
  }
  .grid3d::before,.grid3d::after{
    content:""; position:absolute; inset:-20% -20% 0 -20%; transform:rotateX(65deg) translateY(15vh);
    background:
      linear-gradient(transparent 31px, var(--grid) 32px, transparent 33px) 0 0/100% 32px,
      linear-gradient(90deg, transparent 31px, var(--grid) 32px, transparent 33px) 0 0/32px 100%;
    opacity:.15; filter:drop-shadow(0 0 10px var(--grid));
    animation:gridMove 20s linear infinite;
  }
  .grid3d::after{ animation-duration:34s; opacity:.08; }
  @keyframes gridMove { from{ transform:rotateX(65deg) translateY(15vh) translateZ(0); } to{ transform:rotateX(65deg) translateY(15vh) translateZ(-600px);} }

  /* scanlines + noise */
  .scan{ position:fixed; inset:0; pointer-events:none; z-index:999; }
  .scan::before{
    content:""; position:absolute; inset:0; background:repeating-linear-gradient(0deg,rgba(255,255,255,.02) 0 2px,transparent 2px 4px);
    mix-blend-mode:overlay; animation:scan 6s linear infinite;
  }
  @keyframes scan{ from{ transform:translateY(-100%);} to{ transform:translateY(100%);} }

  /* container */
  .wrap{ max-width:1100px; margin:0 auto; padding:32px 20px 80px; }
  header{ display:flex; align-items:center; gap:16px; margin:8px 0 22px; }
  .badge{
    border:1px solid var(--neon); color:var(--neon); padding:6px 10px; border-radius:999px;
    text-transform:uppercase; font-size:12px; letter-spacing:.2em; backdrop-filter:blur(6px);
    box-shadow:0 0 12px #00e7ff55 inset, 0 0 24px #00e7ff33;
  }
  h1{ font-size:clamp(22px,3.2vw,34px); margin:0; letter-spacing:.04em; text-shadow:0 0 12px #00e7ff44; }
  .subtitle{ opacity:.75; margin-top:-6px; font-size:13px }

  /* card */
  .card{
    background:var(--glass); border:1px solid #37e1ff22; border-radius:18px; padding:18px;
    box-shadow:0 8px 30px #00000055, inset 0 0 0 1px #00d9ff22; transform-style:preserve-3d;
    transition:transform .3s ease, box-shadow .3s ease, border-color .3s ease;
    backdrop-filter: blur(10px) saturate(120%);
  }
  .card:hover{ transform:rotateX(6deg) rotateY(-4deg) translateZ(8px); box-shadow:0 18px 60px #001a3f88, inset 0 0 0 1px #00f0ff44; }

  .grid{ display:grid; gap:16px; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); }

  /* field */
  label{ font-size:12px; letter-spacing:.12em; color:#9feaff; text-transform:uppercase }
  .field{ display:grid; gap:8px; }
  input[type="text"]{
    background:#031022; color:var(--white); border:1px solid #1e9bd8; border-radius:12px; padding:12px 14px;
    outline:none; font-size:15px; transition:border-color .2s, box-shadow .2s;
  }
  input[type="text"]:focus{ border-color:#4be3ff; box-shadow:0 0 0 3px #00e5ff33; }
  .status{ font-size:12px; min-height:16px }
  .ok{ color:var(--ok) } .ng{ color:var(--danger) }

  /* buttons */
  .btn{
    appearance:none; border:none; color:#05202a; background:linear-gradient(180deg,#9ffcff,#67e9ff);
    padding:12px 16px; border-radius:12px; font-weight:700; letter-spacing:.06em; cursor:pointer;
    box-shadow:0 8px 24px #00e5ff55, inset 0 -2px 0 #00b3c9; transition:transform .06s ease, filter .2s;
  }
  .btn:active{ transform:translateY(2px); }
  .btn.ghost{
    background:transparent; color:#b7ecff; border:1px solid #58e4ff77; box-shadow:none;
  }

  /* stage displays */
  .display{
    border:1px dashed #3be7ff55; border-radius:16px; padding:14px; min-height:56px; display:flex; align-items:center;
    background:linear-gradient(180deg,#01152666,#00101f66);
  }
  .type{
    font-size:clamp(20px,4vw,36px); letter-spacing:.08em; white-space:nowrap; overflow:hidden; border-right:2px solid #79f5ff55;
    width:0; animation:typing 2.2s steps(24,end) forwards, caret 1s step-end infinite;
  }
  @keyframes typing { to{ width:100%; } }
  @keyframes caret{ 50%{ border-color:transparent } }

  /* glitch text */
  .glitch{ position:relative; display:inline-block; filter:drop-shadow(0 0 12px #00f0ff66); }
  .glitch::before,.glitch::after{
    content:attr(data-text); position:absolute; inset:0; mix-blend-mode:screen; pointer-events:none;
  }
  .glitch::before{ transform:translate(1px,-1px); color:#f0f; opacity:.25; }
  .glitch::after{ transform:translate(-1px,1px); color:#0ff; opacity:.25; }

  /* footer */
  footer{ opacity:.6; margin-top:28px; font-size:12px; display:flex; gap:10px; flex-wrap:wrap }

  /* responsive note */
  .hint{ font-size:12px; color:#a8d9ff; opacity:.8 }

  /* floating reticle */
  .reticle{ position:fixed; left:50%; top:50%; width:24px; height:24px; margin:-12px 0 0 -12px; pointer-events:none; z-index:5;
    border:1px solid #35e7ff66; border-radius:50%; box-shadow:0 0 18px #00e5ff44; }
</style>
</head>
<body>
<div class="grid3d"></div>
<div class="scan"></div>
<div class="reticle"></div>

<div class="wrap">
  <header>
    <span class="badge">AR/VR • HACKER MODE • ROOM 307</span>
    <h1 class="glitch" data-text="Evidence Board">Evidence Board</h1>
  </header>
  <p class="subtitle">ใส่รหัส 4 ห้องให้ครบเพื่อปลดล็อกลำดับถัดไป (ระบบจะไม่เฉลยคำตอบจนกว่าจะใส่ถูก)</p>

  <!-- INPUT GRID -->
  <section class="grid">
    <div class="card">
      <div class="field">
        <label>ห้อง 305</label>
        <input id="r305" type="text" inputmode="text" autocomplete="off" placeholder="????" />
        <div id="s305" class="status">&nbsp;</div>
      </div>
    </div>

    <div class="card">
      <div class="field">
        <label>ห้อง 303–304</label>
        <input id="r334" type="text" inputmode="text" autocomplete="off" placeholder="????" />
        <div id="s334" class="status">&nbsp;</div>
      </div>
    </div>

    <div class="card">
      <div class="field">
        <label>ห้อง 306</label>
        <input id="r306" type="text" inputmode="text" autocomplete="off" placeholder="????" />
        <div id="s306" class="status">&nbsp;</div>
      </div>
    </div>

    <div class="card">
      <div class="field">
        <label>ห้อง 302</label>
        <input id="r302" type="text" inputmode="text" autocomplete="off" placeholder="????" />
        <div id="s302" class="status">&nbsp;</div>
      </div>
    </div>
  </section>

  <div style="height:14px"></div>

  <div class="card">
    <div style="display:flex; gap:12px; flex-wrap:wrap">
      <button class="btn" id="check">ตรวจสอบ 4 ห้อง</button>
      <button class="btn ghost" id="reset">ล้างค่า</button>
      <span class="hint">ระบบตรวจแบบ <b>case-insensitive</b>, เว้นวรรค/ช่องว่างไม่สนใจ</span>
    </div>
    <div style="height:12px"></div>
    <div class="display" id="stage1">
      <!-- typewriter injects here -->
    </div>
  </div>

  <!-- STAGE 2: Compose full phrase after success -->
  <div id="composeArea" class="card" style="display:none; margin-top:16px">
    <label>ประกอบข้อความ</label>
    <div class="display" id="stage2"></div>
  </div>

  <!-- FINAL CHALLENGE -->
  <div id="finalArea" class="card" style="display:none; margin-top:16px">
    <div class="field">
      <label>คำถามสุดท้าย</label>
      <p class="hint">"จะมีแค่ตัวหน้าสุดเท่านั้นที่เขาได้ และเป็นตัวใหญ่ด้วย" — กรอกรหัสเพื่อยืนยันคำตอบที่แท้จริง</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
        <input id="final" type="text" placeholder="ใส่รหัสยืนยัน..." />
        <button class="btn" id="finalBtn">ยืนยัน</button>
        <div id="finalStatus" class="status">&nbsp;</div>
      </div>
    </div>
  </div>

  <!-- SUCCESS -->
  <div id="successArea" class="card" style="display:none; margin-top:16px">
    <div class="display">
      <span class="glitch" data-text="ACCESS GRANTED">ACCESS GRANTED</span>&nbsp;—&nbsp;<b>Code: <span id="finalCode">CSIT</span></b>
      <button class="btn ghost" id="copy">คัดลอก</button>
    </div>
    <p class="hint">นำโค้ดนี้ไปใส่ที่ <b>Terminal-F3</b></p>
  </div>

  <footer>
    <span>© ROOM 307 • AR/VR Hacker Interface</span>
    <span>UI: 3D tilt + hologram grid + glitch + typewriter</span>
  </footer>
</div>

<script>
/* ====== Utils: normalize + hash (Web Crypto) ====== */
const SALT = "R307|s@lt9";
/* Precomputed salted SHA-256 targets (salt + valueLower) */
const TARGETS = {
  r305: "ea185ef0852c06321c9124ce3b42a195dfa0f719a8aa92a2f24921761fbb1dad",
  r334: "bebd2545c9d5ec80d33b45e2007b80fef262469017298f8f57da6a9769d062a1",
  r306: "8a0eb5e83ca43de73c5042a4f6a86374f3d5289e8eded89d8515fa3689c671ce",
  r302: "32dda16893a9f256ced37f7409f7dd749b6c0cad86d7a53245ccff9e8d8d3b59",
  final: "4fa67cd634c78b91a67dc33e16aaca06547c6b239ef6939e55f4be8cc9e9af70"
};
const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
const norm = s => (s||"").toString().trim().toLowerCase().replace(/\s+/g," ");

async function sha256Hex(str){
  const enc = new TextEncoder().encode(str);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  const arr = Array.from(new Uint8Array(buf));
  return arr.map(b => b.toString(16).padStart(2,"0")).join("");
}
async function checkField(inputId, targetHex, statusId){
  const v = norm($(inputId).value);
  const h = await sha256Hex(SALT + v);
  const ok = (h === targetHex);
  const s = $(statusId);
  s.textContent = ok ? "✔ ถูกต้อง" : (v ? "✖ ยังไม่ถูก" : "");
  s.className = "status " + (ok ? "ok" : (v ? "ng": ""));
  return ok;
}

/* ====== Stage logic ====== */
const ids = { r305:"#r305", r334:"#r334", r306:"#r306", r302:"#r302" };
const sts = { r305:"#s305", r334:"#s334", r306:"#s306", r302:"#s302" };

$("#check").addEventListener("click", async () => {
  const ok305 = await checkField(ids.r305, TARGETS.r305, sts.r305);
  const ok334 = await checkField(ids.r334, TARGETS.r334, sts.r334);
  const ok306 = await checkField(ids.r306, TARGETS.r306, sts.r306);
  const ok302 = await checkField(ids.r302, TARGETS.r302, sts.r302);

  if (ok305 && ok334 && ok306 && ok302){
    stage1Reveal();
  } else {
    $("#stage1").innerHTML = `<span class="ng">บางห้องยังไม่ถูก ต้องการความพยายามมากขึ้น…</span>`;
  }
});

$("#reset").addEventListener("click", () => {
  ["#r305","#r334","#r306","#r302","#final"].forEach(id=> $(id).value = "");
  ["#s305","#s334","#s306","#s302","#finalStatus"].forEach(id=> { $(id).textContent=""; $(id).className="status";});
  $("#stage1").innerHTML = "";
  $("#composeArea").style.display = "none";
  $("#finalArea").style.display = "none";
  $("#successArea").style.display = "none";
});

function typeInto(el, text){
  el.innerHTML = `<span class="type">${text}</span>`;
}

function stage1Reveal(){
  // Step 1: show "Technology"
  typeInto($("#stage1"), "Technology");
  // Step 2: Show compose full phrase
  setTimeout(() => {
    $("#composeArea").style.display = "";
    typeInto($("#stage2"), "Computer Science and Information Technology");
    // Step 3: Enable Final challenge
    setTimeout(()=> { $("#finalArea").style.display = ""; }, 1600);
  }, 900);
}

/* ====== Final check ====== */
$("#finalBtn").addEventListener("click", async () => {
  const v = norm($("#final").value);
  const h = await sha256Hex(SALT + v);
  const ok = (h === TARGETS.final);
  const status = $("#finalStatus");
  if (ok){
    status.textContent = "✔ ยืนยันสำเร็จ";
    status.className = "status ok";
    $("#successArea").style.display = "";
  } else {
    status.textContent = "✖ ไม่ถูกต้อง";
    status.className = "status ng";
  }
});

/* Copy button */
$("#copy").addEventListener("click", async () => {
  try{
    await navigator.clipboard.writeText("CSIT");
    $("#copy").textContent = "คัดลอกแล้ว";
    setTimeout(()=>$("#copy").textContent="คัดลอก", 1200);
  }catch(e){ alert("คัดลอกไม่สำเร็จ"); }
});

/* ====== Tiny AR/VR ambience ====== */
document.addEventListener("mousemove", e=>{
  const cx = (e.clientX / innerWidth - .5) * 2;
  const cy = (e.clientY / innerHeight - .5) * 2;
  document.body.style.setProperty("transform", `rotateX(${cy*-1.5}deg) rotateY(${cx*1.5}deg)`);
  const ret = $(".reticle");
  ret.style.transform = `translate3d(${cx*10}px, ${cy*10}px, 0)`;
});
</script>
</body>
</html>
