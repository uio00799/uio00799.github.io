<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BIOS Directory Scanner</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    background: #000;
    color: #aaa;
    font-family: 'Courier New', monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }

  .bios-container {
    width: 100%;
    max-width: 900px;
    border: 2px solid #00f;
    background: #000;
    box-shadow: 0 0 20px rgba(0, 0, 255, 0.3);
  }

  .bios-header {
    background: #00f;
    color: #fff;
    padding: 5px 10px;
    display: flex;
    justify-content: space-between;
    font-weight: bold;
  }

  .bios-title {
    text-align: center;
    padding: 10px;
    border-bottom: 2px solid #00f;
    color: #0ff;
    font-size: 18px;
    letter-spacing: 2px;
  }

  .bios-content {
    padding: 20px;
  }

  .info-section {
    margin-bottom: 20px;
    padding: 10px;
    border: 1px solid #444;
  }

  .info-row {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    color: #aaa;
  }

  .info-label {
    color: #0ff;
  }

  .control-section {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #444;
    flex-wrap: wrap;
    align-items: center;
  }

  .bios-select, .bios-input {
    background: #111;
    color: #0f0;
    border: 1px solid #00f;
    padding: 6px 10px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
  }

  .bios-input {
    flex: 1;
    min-width: 200px;
  }

  .file-list {
    border: 2px solid #00f;
    padding: 0;
    background: #111;
    min-height: 300px;
    max-height: 400px;
    overflow-y: auto;
    margin: 20px 0;
  }

  .file-list-header {
    color: #fff;
    background: #00f;
    padding: 8px 10px;
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 80px;
    gap: 10px;
    font-weight: bold;
  }

  .file-row {
    padding: 8px 10px;
    cursor: pointer;
    color: #aaa;
    transition: all 0.1s;
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 80px;
    gap: 10px;
    align-items: center;
    border-bottom: 1px solid #222;
  }

  .file-row:hover {
    background: #222;
    color: #fff;
  }

  .file-row.selected {
    background: #00f;
    color: #fff;
  }

  .file-name::before {
    content: "üìÑ ";
    margin-right: 5px;
  }

  .file-name.index::before {
    content: "üè† ";
  }

  .file-link {
    color: #0ff;
    text-decoration: none;
    font-size: 11px;
  }

  .file-link:hover {
    color: #ff0;
    text-decoration: underline;
  }

  .button-section {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
    padding: 20px;
    border-top: 2px solid #00f;
    flex-wrap: wrap;
  }

  .bios-button {
    background: #444;
    color: #fff;
    border: 2px solid #00f;
    padding: 10px 20px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .bios-button:hover {
    background: #00f;
    box-shadow: 0 0 10px rgba(0, 0, 255, 0.5);
  }

  .bios-button:active {
    background: #0088ff;
  }

  .status-bar {
    background: #00f;
    color: #fff;
    padding: 8px 10px;
    display: flex;
    justify-content: space-between;
    font-size: 12px;
  }

  .blink {
    animation: blink 1s infinite;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  .empty-state {
    color: #888;
    text-align: center;
    padding: 60px 20px;
  }

  .status-badge {
    display: inline-block;
    padding: 4px 8px;
    background: #222;
    border: 1px solid #00f;
    color: #0f0;
    font-size: 11px;
    margin-left: 10px;
  }

  .hint {
    color: #888;
    font-size: 11px;
    margin-top: 10px;
    padding: 8px;
    border: 1px solid #333;
  }
</style>
</head>
<body>
<div class="bios-container">
  <div class="bios-header">
    <span>BIOS SETUP UTILITY</span>
    <span>Ver 3.0</span>
  </div>

  <div class="bios-title">
    ‚ïê‚ïê‚ïê DIRECTORY SCANNER ‚ïê‚ïê‚ïê
  </div>

  <div class="bios-content">
    <div class="info-section">
      <div class="info-row">
        <span class="info-label">System Date:</span>
        <span id="currentDate"></span>
      </div>
      <div class="info-row">
        <span class="info-label">System Time:</span>
        <span id="currentTime"></span>
      </div>
      <div class="info-row">
        <span class="info-label">Files Found:</span>
        <span id="fileCount">0</span>
      </div>
      <div class="info-row">
        <span class="info-label">Status:</span>
        <span id="statusText" style="color: #0f0;">READY</span>
      </div>
    </div>

    <div class="control-section">
      <label style="color: #0ff;">FILTER:</label>
      <select id="extFilter" class="bios-select">
        <option value="">ALL FILES</option>
        <option>.html</option><option>.htm</option>
        <option>.php</option><option>.txt</option>
        <option>.js</option><option>.css</option>
        <option>.json</option><option>.png</option>
        <option>.jpg</option><option>.pdf</option>
      </select>

      <label style="color: #0ff;">SEARCH:</label>
      <input id="searchBox" type="text" class="bios-input" placeholder="TYPE FILENAME...">
    </div>

    <div class="file-list">
      <div class="file-list-header">
        <div>FILENAME / PATH</div>
        <div>SIZE</div>
        <div>TYPE</div>
        <div>ACTION</div>
      </div>
      <div id="fileListContent">
        <div class="empty-state">
          NO FILES LOADED<br>
          <span style="color: #666; font-size: 11px;">SELECT MODE A OR MODE B TO BEGIN</span>
        </div>
      </div>
    </div>

    <div class="hint">
      <span style="color: #0ff;">TIP:</span> MODE A requires Apache AutoIndex (Options +Indexes). MODE B uses local folder picker (Chrome/Edge on HTTPS/localhost).
    </div>

    <div class="button-section">
      <button class="bios-button" id="scanServerBtn">MODE A: SCAN SERVER</button>
      <button class="bios-button" id="pickDirBtn">MODE B: PICK LOCAL FOLDER</button>
      <button class="bios-button" onclick="resetData()">CLEAR ALL</button>
    </div>
  </div>

  <div class="status-bar">
    <span>‚Üë‚Üì: Navigate | ENTER: Open File | F1: Help | ESC: Exit</span>
    <span class="blink">‚óè</span>
  </div>
</div>

<script>
const statusText = document.getElementById('statusText');
const fileCount = document.getElementById('fileCount');
const fileListContent = document.getElementById('fileListContent');
const extFilter = document.getElementById('extFilter');
const searchBox = document.getElementById('searchBox');
const scanServerBtn = document.getElementById('scanServerBtn');
const pickDirBtn = document.getElementById('pickDirBtn');

let entries = [];
let selectedIndex = -1;

function updateDateTime() {
  const now = new Date();
  document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH');
  document.getElementById('currentTime').textContent = now.toLocaleTimeString('th-TH');
}

function formatBytes(bytes) {
  if (bytes == null) return '---';
  if (bytes === 0) return '0 B';
  const k = 1024, sizes = ['B','KB','MB','GB','TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function render() {
  const ext = extFilter.value.toLowerCase();
  const q = searchBox.value.trim().toLowerCase();
  fileListContent.innerHTML = '';

  const filtered = entries
    .filter(f => !ext || f.name.toLowerCase().endsWith(ext))
    .filter(f => !q || f.name.toLowerCase().includes(q))
    .sort((a,b) => a.name.localeCompare(b.name));

  if (filtered.length === 0) {
    fileListContent.innerHTML = '<div class="empty-state">NO MATCHING FILES</div>';
    return;
  }

  filtered.forEach((file, index) => {
    const row = document.createElement('div');
    row.className = 'file-row';
    
    const isIndex = file.name.toLowerCase() === 'index.html';
    const nameClass = isIndex ? 'file-name index' : 'file-name';
    
    row.innerHTML = `
      <div class="${nameClass}">${file.path || file.name}</div>
      <div>${formatBytes(file.size)}</div>
      <div>${file.type || '---'}</div>
      <div>${file.href ? `<a href="${file.href}" target="_blank" rel="noopener" class="file-link">OPEN</a>` : '<span style="color:#555">---</span>'}</div>
    `;
    
    row.onclick = (e) => {
      if (e.target.tagName !== 'A') {
        selectFile(index, filtered);
      }
    };
    
    fileListContent.appendChild(row);
  });

  fileCount.textContent = filtered.length;
}

function selectFile(index, filteredList) {
  const rows = fileListContent.querySelectorAll('.file-row');
  rows.forEach((row, i) => {
    row.classList.toggle('selected', i === index);
  });
  selectedIndex = index;
}

async function scanFromServer() {
  statusText.textContent = 'SCANNING SERVER...';
  statusText.style.color = '#ff0';
  try {
    const res = await fetch('./', { method: 'GET' });
    const html = await res.text();

    const dom = new DOMParser().parseFromString(html, 'text/html');
    const links = [...dom.querySelectorAll('a')];

    const items = links
      .map(a => a.getAttribute('href') || '')
      .filter(h => h && h !== '../' && !h.endsWith('/'));

    if (!items.length) {
      statusText.textContent = 'NO FILES FOUND';
      statusText.style.color = '#f00';
      entries = [];
      render();
      return;
    }

    entries = items.map(h => {
      const name = decodeURIComponent(h).split('/').pop();
      const ext = name.includes('.') ? name.split('.').pop() : '';
      return {
        name, size: null, type: ext, href: h, path: name
      };
    });

    statusText.textContent = 'SERVER SCAN COMPLETE';
    statusText.style.color = '#0f0';
    render();
  } catch (e) {
    console.error(e);
    statusText.textContent = 'SCAN FAILED';
    statusText.style.color = '#f00';
    entries = [];
    render();
  }
}

async function pickDirectory() {
  if (!('showDirectoryPicker' in window)) {
    alert('BROWSER NOT SUPPORTED\nUse Chrome/Edge on HTTPS or localhost');
    return;
  }
  statusText.textContent = 'READING LOCAL FOLDER...';
  statusText.style.color = '#ff0';
  try {
    const dirHandle = await window.showDirectoryPicker();
    entries = [];
    for await (const [name, handle] of dirHandle.entries()) {
      if (handle.kind === 'file') {
        const file = await handle.getFile();
        const ext = name.includes('.') ? name.split('.').pop() : '';
        entries.push({
          name, size: file.size, type: ext, href: URL.createObjectURL(file), path: name
        });
      }
    }
    statusText.textContent = 'LOCAL SCAN COMPLETE';
    statusText.style.color = '#0f0';
    render();
  } catch (e) {
    if (e && e.name === 'AbortError') {
      statusText.textContent = 'SCAN CANCELLED';
      statusText.style.color = '#888';
    } else {
      console.error(e);
      statusText.textContent = 'SCAN FAILED';
      statusText.style.color = '#f00';
    }
  }
}

function resetData() {
  entries = [];
  selectedIndex = -1;
  fileCount.textContent = '0';
  statusText.textContent = 'READY';
  statusText.style.color = '#0f0';
  searchBox.value = '';
  extFilter.value = '';
  fileListContent.innerHTML = '<div class="empty-state">NO FILES LOADED<br><span style="color: #666; font-size: 11px;">SELECT MODE A OR MODE B TO BEGIN</span></div>';
}

scanServerBtn.addEventListener('click', scanFromServer);
pickDirBtn.addEventListener('click', pickDirectory);
extFilter.addEventListener('change', render);
searchBox.addEventListener('input', render);

// Keyboard navigation
document.addEventListener('keydown', (e) => {
  const rows = fileListContent.querySelectorAll('.file-row');
  if (rows.length === 0) return;

  if (e.key === 'ArrowUp' && selectedIndex > 0) {
    selectFile(selectedIndex - 1, entries);
    rows[selectedIndex].scrollIntoView({ block: 'nearest' });
    e.preventDefault();
  } else if (e.key === 'ArrowDown' && selectedIndex < rows.length - 1) {
    selectFile(selectedIndex + 1, entries);
    rows[selectedIndex].scrollIntoView({ block: 'nearest' });
    e.preventDefault();
  } else if (e.key === 'Enter' && selectedIndex >= 0) {
    const link = rows[selectedIndex].querySelector('.file-link');
    if (link) link.click();
    e.preventDefault();
  }
});

setInterval(updateDateTime, 1000);
updateDateTime();

// Auto-scan on load
scanFromServer();
</script>
</body>
</html>
