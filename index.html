<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Directory Scanner ¬∑ GitHub Pages</title>
<style>
  :root { color-scheme: dark; }
  body{font-family:system-ui,Segoe UI,Arial; background:#0e1116; color:#e6e6e6; margin:0; padding:24px}
  h1{margin:0 0 6px}
  .sub{color:#a8b0bb;margin:0 0 16px}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:6px 0 14px}
  input,select,button{
    background:#141922; color:#e6e6e6; border:1px solid #2a3040; border-radius:10px; padding:8px 12px
  }
  button{cursor:pointer}
  table{width:100%; border-collapse:collapse; margin-top:6px}
  th,td{padding:10px; border-bottom:1px solid #1f2633; text-align:left; vertical-align:top}
  tr:hover{background:#121724}
  a{color:#9ec5ff; text-decoration:none} a:hover{text-decoration:underline}
  .badge{font-size:12px; padding:4px 8px; border:1px solid #2a3040; border-radius:999px; color:#b7bec9}
  .muted{color:#95a0af}
  .ok{color:#7ee787}
  .err{color:#ff7b72}
</style>
</head>
<body>
<h1>üîç Directory Scanner</h1>
<p class="sub">‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô repo GitHub ‡∏Ç‡∏≠‡∏á GitHub Pages ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö/‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á</p>

<!-- ====== Config (‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ) ====== -->
<div class="row">
  <label class="badge">Owner</label><input id="owner" value="uio00799">
  <label class="badge">Repo</label><input id="repo" value="uio00799.github.io">
  <label class="badge">Branch</label><input id="branch" value="main">
  <button id="scanBtn">‡∏™‡πÅ‡∏Å‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
  <span id="status" class="badge">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
</div>

<div class="row">
  <label class="badge">‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <select id="extFilter">
    <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    <option>.html</option><option>.htm</option>
    <option>.md</option><option>.txt</option>
    <option>.js</option><option>.css</option><option>.json</option>
    <option>.png</option><option>.jpg</option><option>.jpeg</option><option>.gif</option>
    <option>.pdf</option>
  </select>

  <label class="badge">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
  <input id="q" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô logic, index, readme">
</div>

<table id="tbl">
  <thead>
    <tr>
      <th>‡∏û‡∏≤‡∏ò</th>
      <th>‡∏Ç‡∏ô‡∏≤‡∏î</th>
      <th>‡∏ä‡∏ô‡∏¥‡∏î</th>
      <th>‡πÄ‡∏õ‡∏¥‡∏î (‡πÄ‡∏ß‡πá‡∏ö)</th>
      <th>RAW</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const ownerEl  = document.getElementById('owner');
const repoEl   = document.getElementById('repo');
const branchEl = document.getElementById('branch');
const statusEl = document.getElementById('status');
const scanBtn  = document.getElementById('scanBtn');
const tbody    = document.querySelector('#tbl tbody');
const qEl      = document.getElementById('q');
const extEl    = document.getElementById('extFilter');

let allEntries = []; // ‡∏à‡∏≤‡∏Å Git Tree API

function formatBytes(bytes){
  if (bytes == null) return '-';
  if (bytes === 0) return '0 B';
  const k = 1024, units = ['B','KB','MB','GB','TB'];
  const i = Math.floor(Math.log(bytes)/Math.log(k));
  return (bytes/Math.pow(k,i)).toFixed(2)+' '+units[i];
}

function render(){
  const q   = qEl.value.trim().toLowerCase();
  const ext = extEl.value.toLowerCase();

  const filtered = allEntries
    .filter(x => x.type === 'blob')                    // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå
    .filter(x => !ext || x.path.toLowerCase().endsWith(ext))
    .filter(x => !q   || x.path.toLowerCase().includes(q))
    .sort((a,b)=> a.path.localeCompare(b.path));

  tbody.innerHTML = '';
  for (const f of filtered){
    const tr = document.createElement('tr');
    const webUrl = `https://${ownerEl.value}.github.io/${encodeURI(f.path)}`;
    const rawUrl = `https://raw.githubusercontent.com/${ownerEl.value}/${repoEl.value}/${branchEl.value}/${encodeURI(f.path)}`;
    const ext = f.path.includes('.') ? f.path.split('.').pop() : '-';
    tr.innerHTML = `
      <td>${f.path}</td>
      <td>${formatBytes(f.size)}</td>
      <td>${ext}</td>
      <td><a href="${webUrl}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î</a></td>
      <td><a href="${rawUrl}" target="_blank" rel="noopener">RAW</a></td>
    `;
    tbody.appendChild(tr);
  }
  statusEl.textContent = `‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå: ${filtered.length}/${allEntries.filter(x=>x.type==='blob').length}`;
}

async function scan(){
  const owner  = ownerEl.value.trim();
  const repo   = repoEl.value.trim();
  const branch = branchEl.value.trim() || 'main';

  statusEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‚Ä¶';
  try{
    // ‡πÉ‡∏ä‡πâ Git Trees API (recursive=1) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á repo
    const api = `https://api.github.com/repos/${owner}/${repo}/git/trees/${encodeURIComponent(branch)}?recursive=1`;
    const res = await fetch(api);
    if (!res.ok){
      const text = await res.text();
      throw new Error(`HTTP ${res.status}: ${text}`);
    }
    const data = await res.json();
    // data.tree: [{path, mode, type: 'blob'|'tree', size?, sha, url}, ...]
    allEntries = data.tree.map(x => ({
      path: x.path, type: x.type, size: x.size ?? null
    }));
    statusEl.textContent = '‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ';
    render();
  }catch(err){
    console.error(err);
    statusEl.textContent = '‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå';
    tbody.innerHTML = `<tr><td colspan="5" class="err">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}</td></tr>`;
  }
}

// events
scanBtn.addEventListener('click', scan);
qEl.addEventListener('input', render);
extEl.addEventListener('change', render);

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
scan();
</script>
</body>
</html>
