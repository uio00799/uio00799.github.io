<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Directory Scanner (HTML-only)</title>
<style>
  :root { color-scheme: dark; }
  body { font-family: system-ui, sans-serif; background:#0d0f12; color:#e6e6e6; margin:0; padding:24px; }
  h1 { margin:0 0 6px; }
  .sub { color:#a8b0bb; margin:0 0 16px; }
  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
  button, select, input[type="text"] {
    background:#13161b; color:#e6e6e6; border:1px solid #2a2f38; border-radius:10px; padding:8px 12px;
  }
  table { width:100%; border-collapse:collapse; margin-top:12px; }
  th, td { padding:10px; border-bottom:1px solid #1c2129; text-align:left; }
  tr:hover { background:#12161c; }
  a { color:#9ec5ff; text-decoration:none; } a:hover{text-decoration:underline;}
  .badge { font-size:12px; padding:4px 8px; border:1px solid #2a2f38; border-radius:999px; color:#b7bec9; }
  .hint { font-size:13px; color:#9aa3ad; }
  .muted { color:#9aa3ad; }
</style>
</head>
<body>
<h1>üîç Directory Scanner (HTML-only)</h1>
<p class="sub">‡πÇ‡∏´‡∏°‡∏î A: ‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å ‚Äú‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (Apache AutoIndex)‚Äù ‚Ä¢ ‡πÇ‡∏´‡∏°‡∏î B: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>

<div class="row">
  <button id="scanServerBtn">‡πÇ‡∏´‡∏°‡∏î A: ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</button>
  <button id="pickDirBtn">‡πÇ‡∏´‡∏°‡∏î B: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
  <span class="badge" id="status">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
</div>

<div class="row">
  <label class="badge">‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <select id="extFilter">
    <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    <option>.html</option><option>.htm</option>
    <option>.php</option><option>.txt</option>
    <option>.js</option><option>.css</option>
    <option>.json</option><option>.png</option>
    <option>.jpg</option><option>.jpeg</option><option>.gif</option>
    <option>.pdf</option>
  </select>

  <label class="badge">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå</label>
  <input id="searchBox" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô index, about, data">
</div>

<table id="fileTable">
  <thead>
    <tr>
      <th>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå / ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</th>
      <th>‡∏Ç‡∏ô‡∏≤‡∏î</th>
      <th>‡∏ä‡∏ô‡∏¥‡∏î</th>
      <th>‡πÄ‡∏õ‡∏¥‡∏î</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<p class="hint">
  ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÇ‡∏´‡∏°‡∏î A ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î <code>Options +Indexes</code> (Apache AutoIndex) ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô
  ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î ‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‚Äù ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå
</p>

<script>
const statusEl = document.getElementById('status');
const tableBody = document.querySelector('#fileTable tbody');
const extFilter = document.getElementById('extFilter');
const searchBox = document.getElementById('searchBox');
const scanServerBtn = document.getElementById('scanServerBtn');
const pickDirBtn = document.getElementById('pickDirBtn');

let entries = []; // {name, size, type, href}

function formatBytes(bytes) {
  if (bytes == null) return '-';
  if (bytes === 0) return '0 B';
  const k = 1024, sizes = ['B','KB','MB','GB','TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function render() {
  const ext = extFilter.value.toLowerCase();
  const q = searchBox.value.trim().toLowerCase();
  tableBody.innerHTML = '';

  entries
    .filter(f => !ext || f.name.toLowerCase().endsWith(ext))
    .filter(f => !q || f.name.toLowerCase().includes(q))
    .sort((a,b) => a.name.localeCompare(b.name))
    .forEach(file => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${file.path || file.name}</td>
        <td>${formatBytes(file.size)}</td>
        <td>${file.type || '-'}</td>
        <td>${file.href ? `<a href="${file.href}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î</a>` : '<span class="muted">‚Äî</span>'}</td>
      `;
      tableBody.appendChild(tr);
    });
}

// ‡πÇ‡∏´‡∏°‡∏î A: ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡πà‡∏≤‡∏ô ‚Äú‡∏´‡∏ô‡πâ‡∏≤ directory listing‚Äù ‡∏ó‡∏µ‡πà Apache ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ (AutoIndex)
async function scanFromServer() {
  statusEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‚Ä¶';
  try {
    // ‡∏Ç‡∏≠ HTML ‡∏Ç‡∏≠‡∏á‡πÑ‡∏î‡πÄ‡∏£‡∏Ñ‡∏ó‡∏≠‡∏£‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î Options +Indexes)
    const res = await fetch('./', { method: 'GET' });
    const html = await res.text();

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á DOM ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏∂‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
    const dom = new DOMParser().parseFromString(html, 'text/html');
    const links = [...dom.querySelectorAll('a')];

    // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå (‡∏ï‡∏±‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå ../ ‡πÅ‡∏•‡∏∞‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏ñ‡πâ‡∏≤ Apache ‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô /)
    const items = links
      .map(a => a.getAttribute('href') || '')
      .filter(h => h && h !== '../' && !h.endsWith('/'));

    if (!items.length) {
      statusEl.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å AutoIndex (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î Options +Indexes?)';
      entries = [];
      render();
      return;
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ index HTML ‡∏à‡∏∂‡∏á‡∏õ‡∏•‡πà‡∏≠‡∏¢ size ‡∏ß‡πà‡∏≤‡∏á)
    entries = items.map(h => {
      const name = decodeURIComponent(h).split('/').pop();
      const ext = name.includes('.') ? name.split('.').pop() : '';
      return {
        name, size: null, type: ext, href: h, path: name
      };
    });

    statusEl.textContent = `‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå: ${entries.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    render();
  } catch (e) {
    console.error(e);
    statusEl.textContent = '‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
    entries = [];
    render();
  }
}

// ‡πÇ‡∏´‡∏°‡∏î B: ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (Chromium-based + HTTPS/localhost)
async function pickDirectory() {
  if (!('showDirectoryPicker' in window)) {
    alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö showDirectoryPicker (‡πÉ‡∏ä‡πâ Chrome/Edge ‡∏ö‡∏ô HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost)');
    return;
  }
  statusEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‚Ä¶';
  try {
    const dirHandle = await window.showDirectoryPicker();
    entries = [];
    for await (const [name, handle] of dirHandle.entries()) {
      if (handle.kind === 'file') {
        const file = await handle.getFile();
        const ext = name.includes('.') ? name.split('.').pop() : '';
        entries.push({
          name, size: file.size, type: ext, href: URL.createObjectURL(file), path: name
        });
      }
    }
    statusEl.textContent = `‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå: ${entries.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    render();
  } catch (e) {
    if (e && e.name === 'AbortError') {
      statusEl.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå';
    } else {
      console.error(e);
      statusEl.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ';
    }
  }
}

scanServerBtn.addEventListener('click', scanFromServer);
pickDirBtn.addEventListener('click', pickDirectory);
extFilter.addEventListener('change', render);
searchBox.addEventListener('input', render);

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î A ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ)
scanFromServer();
</script>
</body>
</html>
