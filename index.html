<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Directory Browser</title>
<style>
  :root { --bg:#0b0b12; --panel:#141422; --text:#e6e6f0; --muted:#9aa0a6; --accent:#6aa8ff; --ok:#98e08b; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
  .wrap{width:min(980px,100%);background:var(--panel);border:1px solid #22243a;border-radius:16px;box-shadow:0 10px 32px rgba(0,0,0,.35)}
  .header{padding:18px 20px;border-bottom:1px solid #232544;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .header h1{font-size:18px;margin:0;letter-spacing:.3px}
  .tools{margin-left:auto;display:flex;gap:8px}
  .search{padding:10px 12px;border-radius:10px;border:1px solid #2b2e55;background:#0f1020;color:var(--text);min-width:220px}
  .btn{padding:10px 12px;border-radius:10px;border:1px solid #2b2e55;background:#10122a;color:var(--text);cursor:pointer}
  .btn:hover{border-color:#39407a}
  .content{padding:6px 6px 14px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  @media (max-width:720px){.grid{grid-template-columns:1fr}}
  .card{display:flex;align-items:center;gap:12px;background:#0f1024;border:1px solid #1d2042;border-radius:12px;padding:12px}
  .icon{width:28px;height:28px;border-radius:8px;display:inline-grid;place-items:center;font-weight:700}
  .dir{background:#14284d;color:#a6c6ff}
  .fil{background:#213818;color:#bde7a8}
  .meta{margin-left:auto;text-align:right;color:var(--muted);font-size:12px}
  a.name{color:var(--text);text-decoration:none}
  a.name:hover{color:var(--accent)}
  .empty{color:var(--muted);padding:20px;text-align:center}
  .section-title{margin:14px 8px 4px;color:#b9c0ff;font-size:12px;text-transform:uppercase;letter-spacing:.12em}
  .ft{padding:10px 14px;border-top:1px solid #232544;color:var(--muted);font-size:12px;display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>üìÇ ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</h1>
      <div class="tools">
        <input id="q" class="search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô .html, data, ‡∏†‡∏≤‡∏û" />
        <button id="refresh" class="btn">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
      </div>
    </div>
    <div class="content">
      <div id="dirsTitle" class="section-title" style="display:none">Directories</div>
      <div id="dirs" class="grid"></div>
      <div id="filesTitle" class="section-title" style="display:none">Files</div>
      <div id="files" class="grid"></div>
      <div id="empty" class="empty" style="display:none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå/‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
    </div>
    <div class="ft">
      <div>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡πÄ‡∏ä‡πà‡∏ô <code>.html</code>, <code>.png</code>, ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏ü‡∏•‡πå</div>
      <div>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö <code>index.html</code></div>
    </div>
  </div>

<script>
const elDirs  = document.getElementById('dirs');
const elFiles = document.getElementById('files');
const elDirsTitle  = document.getElementById('dirsTitle');
const elFilesTitle = document.getElementById('filesTitle');
const elEmpty = document.getElementById('empty');
const q = document.getElementById('q');

let DATA = { dirs: [], files: [] };

function humanSize(n){
  if (n == null) return '';
  const u = ['B','KB','MB','GB','TB'];
  let i=0, s=n;
  while (s>=1024 && i<u.length-1){ s/=1024; i++; }
  return s.toFixed(s<10 && i>0 ? 1 : 0) + ' ' + u[i];
}
function humanDate(ms){
  if (!ms) return '';
  const d = new Date(ms);
  return d.toLocaleString();
}

function row(item){
  const wrap = document.createElement('div');
  wrap.className = 'card';

  const icon = document.createElement('div');
  icon.className = 'icon ' + (item.isDir ? 'dir' : 'fil');
  icon.textContent = item.isDir ? 'D' : 'F';

  const link = document.createElement('a');
  link.className = 'name';
  link.textContent = item.name;
  link.title = item.name;
  // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÉ‡∏´‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏∞‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü index ‡∏´‡∏£‡∏∑‡∏≠ list ‡πÄ‡∏≠‡∏á)
  // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå ‡πÉ‡∏´‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
  link.href = encodeURIComponent(item.name) + (item.isDir ? '/' : '');

  const meta = document.createElement('div');
  meta.className = 'meta';
  meta.innerHTML = [
    item.isDir ? '‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå' : humanSize(item.size),
    humanDate(item.mtime)
  ].filter(Boolean).join('<br>');

  wrap.append(icon, link, meta);
  return wrap;
}

function render(filter=''){
  const f = filter.trim().toLowerCase();
  const dirs  = DATA.dirs.filter(x => x.name.toLowerCase().includes(f));
  const files = DATA.files.filter(x => x.name.toLowerCase().includes(f));

  elDirs.innerHTML  = '';
  elFiles.innerHTML = '';

  dirs.forEach(it => elDirs.appendChild(row(it)));
  files.forEach(it => elFiles.appendChild(row(it)));

  elDirsTitle.style.display  = dirs.length  ? '' : 'none';
  elFilesTitle.style.display = files.length ? '' : 'none';
  elEmpty.style.display = (!dirs.length && !files.length) ? '' : 'none';
}

async function load(){
  const res = await fetch('/api/list');
  if (!res.ok){ alert('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); return; }
  DATA = await res.json();
  render(q.value);
}

document.getElementById('refresh').addEventListener('click', load);
q.addEventListener('input', () => render(q.value));

load();
</script>
</body>
</html>
